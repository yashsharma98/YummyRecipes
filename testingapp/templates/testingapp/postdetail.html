{% extends 'testingapp/newnavbar_navrail.html' %}

{% load hitcount_tags %}

{% load static %}

{% load humanize %}

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


{% block title %}
<title>{{post.title}}</title>
{% endblock %}

{% block weather_widget %}
{% endblock %}


{% block sm_weather %}
{% endblock %}

{% block content%}


<body>

  {% if user.is_authenticated %}

  <div class="primary-wrapper postdetail-primary-wrapper" id="scrollableDiv" data-recipe-id="{{post.pk}}" >
    
    <div class="secondary-wrapper">

      <div class="container container-flex">

        <main role="main" class="home-main recipe-detail-main">

            <div class="dynamic-recipes recipe-detail-wrapper">                    

              <div class="dynamic-card-container carousel-container rcdet-card-container">
                
                <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                  
                  {% if post.photo_set.all.count == 1 %}
                  {% else %}
                    <div class="carousel-indicators">
                      {% for image in post.photo_set.all %}
                      <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="{{ forloop.counter0 }}" {% if forloop.first %}class="active"{% endif %}></button>
                      {% endfor %}
                    </div>
                  {% endif %}

                  <div class="carousel-inner">
                    {% for post in post.photo_set.all %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                      <img src="{{ post.image.url }}" class="d-block carousel-image" alt="{{ post.title }}">
                    </div>
                    {% empty %}
                    <div>
                      <img src="{% static 'testingapp/media/empty4.jpg' %}" class="d-block carousel-image" alt="{{ post.title }}">
                    </div>
                    {% endfor %}
                  </div>

                  {% if post.photo_set.all.count == 1 %}
                  {% else %}
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Next</span>
                    </button>
                  {% endif %}
                </div>

              </div>


              <div class="recipe-body">
                <h1 id="title-image-color">{{post.title}}</h1>

                <div class="d-flex recipe-details-1">
                  <div class="auth-img">
                    {% for i in user_profiles %}
                      {% if i.user.email == post.author.email %}
                      <div>
                        <a href="{% url 'userchannelpage' first=post.author.first_name last=post.author.last_name pk=post.author.pk %}">
                          <img src="{{ post.author.profile.profile_img.url }}" alt="Image">
                        </a>
                      </div>
                      {% endif %}
                    {% endfor %}
  
                    <div class="child">
  
                      <div class="card hover-profile-card">
                        <div class="row g-0">
                          <div class="col-lg-4 card-img-container">
                            <img src="{{ post.author.profile.profile_img.url }}" alt="...">
                          </div>
                          <div class="col-md-8">
                            <div class="card-body">
                              <h5 class="card-title">{{ post.author.first_name }} {{ post.author.last_name }}</h5>
                            </div>
                            <div class="cards-footer">
                              {% if total_recipes_by_author == 1 %}
                                {{ total_recipes_by_author }} Recipe
                              {% else %}
                                {{ total_recipes_by_author }} Recipes
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
  
                    </div>
                  </div>
  
                  <div class="flex-grow-1 auth-name">
                    {% for i in user_profiles %}
                      {% if i.user.email == post.author.email %}
                        <div class="text-truncate">
                          <a href="{% url 'userchannelpage' first=post.author.first_name last=post.author.last_name pk=post.author.pk %}">
                            <div class="d-flex justify-content-between recipe-detail-author">
                              <div>
                                <div>{{i.user.first_name}} {{i.user.last_name}}</div>
                                
                                <div>
                                  <span>
                                    {% if followers == 1 %}
                                      {{followers}} Follower
                                    {% else %}
                                      {{followers}} Followers
                                    {% endif %}
                                  </span>
                                </div>
                              </div>

                              <div class="reciepe-details-follow-user-form">
                                {% if post.author.id != request.user.id %}
                                
                                  {% for followed_user in is__following %}

                                    {% if followed_user is False %} <!-- if user is not following the targeted user -->
                                      <form method="post" action="{% url 'follow_unfollow_user' i.user.username %}">
                                          {% csrf_token %}
                                          <button type="submit">Follow</button>
                                      </form>

                                    {% else %}  <!-- if user is following the targeted user -->
                                      <form method="post" action="{% url 'follow_unfollow_user' i.user.username %}">
                                          {% csrf_token %}
                                          <button type="submit">Unfollow</button>
                                      </form>
            
                                    {% endif %}
                                
                                  {% endfor %}

                                {% else %}
                                
                                {% endif %}
                              </div>
                            </div>
                          </a>
                        </div>
                      {% endif %}
                    {% endfor %}


                    
                    <div class="child">
  
                      <div class="card hover-profile-card">
                        <div class="row g-0">
                          <div class="col-lg-4 card-img-container">
                            <img src="{{ post.author.profile.profile_img.url }}" alt="...">
                          </div>
                          <div class="col-md-8">
                            <div class="card-body">
                              <h5 class="card-title">{{ post.author.first_name }} {{ post.author.last_name }}</h5>
                            </div>
                            <div class="cards-footer">
                              {% if total_recipes_by_author == 1 %}
                                {{ total_recipes_by_author }} Recipe
                              {% else %}
                                {{ total_recipes_by_author }} Recipes
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
  
                    </div>
                  </div>
  
                  <div class="like-dislike-div">
                    <div class="like-div">
                      <!-- <form action="{% url 'like-view' %}" method="POST">
                        {% csrf_token %}
                        
                        {% if request.user.profile in post.likes.all %}
  
                          <button type="submit" class="" name="post_id" value="{{post.id}}" data-toggle="tooltip" data-placement="top" title="Unlike">
                            <span class="material-symbols-rounded like-dislike-icon liked">thumb_up</span>  
                          </button>
  
                          <div class="total-likes">{{post.total_likes}}</div>
                        {% else %}
  
                          {% if post.total_likes == 0 %}
  
                            <button type="submit" class="btn btn-light" name="post_id" value="{{post.id}}" data-toggle="tooltip" data-placement="top" title="I like this">
                              <span class="material-symbols-rounded like-dislike-icon">thumb_up</span>  
                            </button>
                              <div class="total-likes">{{post.total_likes}}</div>
  
                          {% else %}
  
                            <button type="submit" class="btn btn-light" name="post_id" value="{{post.id}}" data-toggle="tooltip" data-placement="top" title="I like this">
                              <span class="material-symbols-rounded like-dislike-icon">thumb_up</span>  
                            </button>
                              <div class="total-likes">{{post.total_likes}}</div>
  
                          {% endif %}
  
                        {% endif %}
                        
                      </form> -->
                      <form action="{% url 'like-view' %}" method="POST">
                        {% csrf_token %}
                    
                        <button type="submit" class="like-button {% if request.user.profile in post.likes.all %}liked{% endif %}" data-post-id="{{ post.id }}"
                          data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-original-title="I like this">
                          {% if request.user.profile in post.likes.all %}  
                            <span class="material-symbols-rounded like-dislike-icon liked">thumb_up</span>  
                          {% else %}
                            <span class="material-symbols-rounded like-dislike-icon">thumb_up</span>  
                          {% endif %}
                        </button>
                        
                        <div class="total-likes" data-post-id="{{ post.id }}">{{ post.total_likes }}</div>
                      </form>
                    </div>
                  </div>
  
                  <div class="like-dislike-div">
                    <div class="dislike-div">
                      <!-- <form action="{% url 'dislike-view' %}" method="POST">
                        {% csrf_token %}
  
                        {% if request.user.profile in post.dislikes.all %}
  
                          <button type="submit" class="btn btn-light" name="post_id" value="{{post.id}}" data-toggle="tooltip" data-placement="top" title="Disliked">
                            <span class="material-symbols-rounded like-dislike-icon disliked">thumb_down</span>  
                          </button>
                          <div class="total-dislikes">{{post.total_dislikes}}</div>
  
                        {% else %}
  
                        {% if post.total_dislikes == 0 %}
  
                          <button type="submit" class="btn btn-light" name="post_id" value="{{post.id}}" data-toggle="tooltip" data-placement="top" title="I dislike this">
                            <span class="material-symbols-rounded like-dislike-icon">thumb_down</span>
                          </button>
                          <div class="total-dislikes">{{post.total_dislikes}}</div>
  
                        {% else %}
  
                          <button type="submit" class="btn btn-light" name="post_id" value="{{post.id}}" data-toggle="tooltip" data-placement="top" title="I dislike this">
                            <span class="material-symbols-rounded like-dislike-icon">thumb_down</span>
                          </button>
                          <div class="total-dislikes">{{post.total_dislikes}}</div>
  
                        {% endif %}
  
                        {% endif %}
  
                      </form> -->
                    
                      <form action="{% url 'dislike-view' %}" method="POST">
                        {% csrf_token %}
                    
                        <button type="submit" class="dislike-button {% if request.user.profile in post.dislikes.all %}disliked{% endif %}" data-post-id="{{ post.id }}"
                          data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-original-title="I dislike this">
                          {% if request.user.profile in post.dislikes.all %}  
                            <span class="material-symbols-rounded like-dislike-icon disliked">thumb_down</span>  
                          {% else %}
                            <span class="material-symbols-rounded like-dislike-icon">thumb_down</span>  
                          {% endif %}
                        </button>
                        
                        <div class="total-dislikes" data-post-id="{{ post.id }}">{{ post.total_dislikes }}</div>
                      </form>
                    </div>
                  </div>
  
                  <div class="more-dropmenu">
                    <div class="dropdown-center body-detail-dropdown">
                      <button class="more-dropdown-btn" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                          <span class="material-symbols-rounded more-horiz-icon">more_horiz</span>
                      </button>
  
                      <div class="dropdown-menu body-detail-dropdown-content">
                        <div class="body-detail-dropdown-list">
                          <div class="dropdown-first-child">
                            <button class="dropdown-links" data-bs-toggle="modal" data-bs-target="#shareRecipeModal">
                              <span class="material-symbols-rounded share-recipe-icon">share</span>
                              Share
                            </button>
                          </div>

                          <div class="dropdown-second-child">
                            {% if post in user.favourite.all %}
                            <a class="favourite-link dropdown-links" data-post-id="{{ post.id }}">
                                <span class="material-symbols-rounded favourite-icon-2 share-recipe-icon {% if post in user.favourite.all %}favourite-added{% endif %}">favorite</span>
                                <span class="fav-text">Remove</span>
                            </a>
                            {% else %}
                            <a class="favourite-link dropdown-links" data-post-id="{{ post.id }}">
                                <span class="material-symbols-rounded favourite-icon-2 share-recipe-icon">favorite</span>
                                <span class="fav-text">Favourites</span>
                            </a>
                            {% endif %}
                          </div>

                          <div class="dropdown-second-child">
                            <a class="dropdown-links" href="{% url 'customerrender' feed=post.title pk=post.pk %}">
                              <span class="material-symbols-rounded share-recipe-icon">file_download</span>
                              Download
                            </a>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
  
                </div>                

                <!-- views, trending text & read time -->
                <div class="recipe-trending-text">

                  <div class="d-flex justify-content-start">

                    <span class="trending-number">
                      <p>{% get_hit_count for post %} views</p>
                    </span>

                    {% if post.title in top_10_trend_recipes|join:"" %}
                          
                      <span class="trending-number mx-2">
                        <p>#{{check|join:""}} on Trending</p>
                      </span>  

                    {% else %}

                    {% endif %}
                  </div>

                  <span class="trending-number postdetail-readtime"><p>{{ post.read_time }} min read</p></span>
                </div>

                <div class="recipe-detail-container">
                  <div class="left">

                    <div class="recipe-detail-table">
                      <table class="table">
                        <tbody>
                          <tr>
                              <th scope="row" colspan="2">Type</th>
                              <td>:</td>
                              <td>{{post.type}}</td>
                          </tr>
                          <tr>
                              <th scope="row" colspan="2">Category</th>
                              <td>:</td>
                              <td>{{post.category}}</td>
                          </tr>
                          <tr>
                              <th scope="row" colspan="2">Cuisine</th>
                              <td>:</td>
                              <td>{{post.cuisine|cut:" cuisine"}}</td>
                          </tr>
                          <tr>
                              <th scope="row" colspan="2">Prep time</th>
                              <td>:</td>
                              <td>{{post.timing}} min</td>
                          </tr>
                          <tr>
                              <th scope="row" colspan="2">Servings</th>
                              <td>:</td>
                              <td>{{post.servings}}</td>
                          </tr>
                          <tr>
                            <th scope="row" colspan="2">Difficulty</th>
                            <td>:</td>
                            <td>{{post.difficulty}}</td>
                          </tr>
                            <!-- <tr>
                              <th scope="row" colspan="2">Views</th>
                              <td>:</td>
                              <td>{% get_hit_count for post %}</td>
                          </tr> -->
                          <tr>
                              <th scope="row" colspan="2">Posted</th>
                              <td>:</td>
                              <td>{{post.get_date}}</td>
                          </tr>
                          <tr>
                            <th scope="row" colspan="2">Updated</th>
                            <td>:</td>
                            <td>
                              {% if post.get_date == post.get_modified_date %}
                                No change
                              {% else %}
                              {{post.get_modified_date}}
                              {% endif %}
                            </td>
                          </tr>
                          <!-- <tr>
                              <th scope="row" colspan="2">Popularity </th>
                              <td>:</td>
                              <td>
                                {% if post.type == 'Breakfast' %}

                                  {% if fetched_recipe|join:"" in post.title %}

                                    {% for post in breakfast.all %}

                                      {% if fetched_recipe|join:"" in post.title %}

                                        {{forloop.counter| ordinal }} in breakfast recipes

                                      {% endif %}

                                    {% endfor %}

                                  {% else %}
                                    0
                                  {% endif %}

                                {% elif post.type == 'Lunch' %} 
                                
                                {% if fetched_recipe|join:"" in post.title %}

                                  {% for post in lunch.all %}

                                    {% if fetched_recipe|join:"" in post.title %}

                                      {{forloop.counter| ordinal }} in lunch recipes

                                    {% endif %}

                                  {% endfor %}
                                
                                {% else %}
                                  0
                                {% endif %}

                                {% elif post.type == 'Evening Snack' %} 

                                  {% if fetched_recipe|join:"" in post.title %}

                                    {% for post in evesnack.all %}
                                    
                                      {% if fetched_recipe|join:"" in post.title %}

                                        {{forloop.counter| ordinal }} in evening snack recipes
                                      
                                      {% endif %}
                                
                                    {% endfor %}

                                  {% else %}
                                    0
                                  {% endif %}

                                {% else %}

                                {% if fetched_recipe|join:"" in post.title %}
                                  
                                  {% for post in dinner.all %}
                                  
                                    {% if fetched_recipe|join:"" in post.title %}

                                      {{forloop.counter| ordinal }} in dinner recipes

                                    {% endif %}

                                  {% endfor %}

                                {% else %}
                                  0
                                {% endif %}


                                {% endif %}
                              </td>
                          </tr> -->
                            <!-- <tr>
                                <th scope="row" colspan="2">Likes</th>
                                <td>:</td>
                                <td>{{post.total_likes}}</td>
                            </tr>
                            <tr>
                                <th scope="row" colspan="2">Dislikes</th>
                                <td>:</td>
                                <td>{{post.total_dislikes}}</td>
                            </tr> -->
                        </tbody>
                      </table>
                    </div>

                  </div>

                  {% if nutrition_widget|safe %}
                    <div class="right">
                      
                      <div class="recipe-detail-table">
                        {{ nutrition_widget|safe }}

                        <script>
                          document.addEventListener('DOMContentLoaded', function() {
                              var heading1 = document.querySelector('.spoonacular-caption.spoonacular-salmon');
                              var headingBlue = document.querySelector('.spoonacular-caption.spoonacular-blue');
                              var quickviewText = document.querySelector('.spoonacular-caption');
                              
                              if (heading1 && headingBlue) {
                                heading1.textContent = '';
                                headingBlue.textContent = 'More details';
                              }
        
                              if (quickviewText) {
                                quickviewText.style.display = 'none';
                              }
                          });
                        </script>
                      </div>

                    </div>

                  {% endif %}

                </div>

                <div class="recipe-content-actions">
                  <!-- <button id="listenButton"><span class="material-symbols-rounded recipe-action-icons">graphic_eq</span>Audio</button> -->

                  <!-- <a href="#translated-text-wrapper">
                    <button type="button" id="translateButton"><span class="material-symbols-rounded recipe-action-icons">translate</span>Translate in hindi</button>
                  </a> -->

                  <a class="compare-recipe-collpase" href="{% url 'compare_recipes' post.pk %}">
                    <span class="material-symbols-rounded recipe-action-icons">compare</span>Compare recipe
                  </a>

                  <button type="button" data-bs-toggle="offcanvas" data-bs-target="#simpleViewModal"><span class="material-symbols-rounded recipe-action-icons">dock_to_left</span>Quick view</button>

                  <button type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <span class="material-symbols-rounded recipe-action-icons">shopping_cart</span>Shopping list
                  </button> 

                  <div class="dropdown-menu body-detail-dropdown-content">
                    <div class="body-detail-dropdown-list">
                      <div class="dropdown-first-child">
                        <button class="dropdown-links" data-bs-toggle="modal" data-bs-target="#shoppinglistModal">
                          <span class="material-symbols-rounded share-recipe-icon">format_list_bulleted</span>
                          View list
                        </button>
                      </div>

                      <div class="dropdown-second-child">
                        <a class="dropdown-links" href="{% url 'shopping_list' title=post.title pk=post.pk %}" style="width: 100%;">
                          <span class="material-symbols-rounded share-recipe-icon">file_download</span>
                          Download list
                        </a>
                      </div>
                    </div>
                  </div>

                </div>

                <!-- gtts library audio -->
                <audio controls  id="audioPlayer" preload="none" style="display: none;">
                  <source src="{{ audio_file_new }}" type="audio/mp3">
                </audio>

                <!-- Open ai api audio -->
                <!-- <audio controls id="audioPlayer" preload="none" style="display: none;">
                  <source src="{{ audio_file_name }}" type="audio/mp3">
                </audio> -->

                <div data-spy="scroll" data-target="#navbar-example2" data-offset="50">

                <div class="recipe-body-content ingred-body" id="ingredients">
                  <h4 id="instructions-heading">Ingredients</h4>
                  
                  <div class="recipe-data recipe-data-ingred">
                    {{post.ingredients|safe}}
                  </div>
                </div>

                <div class="recipe-body-content summarizecontent" id="instructions">
                  <h4>Instructions</h4>

                  <div class="recipe-data">
                    {{post.content|safe}}
                  </div>

                  <!-- <p>
                    <pre>{{post.content|safe}}</pre>
                  </p> -->
                  
                </div>

                <div id="translated-text-wrapper">
                  <div class="recipe-body-content translatedcontainer" id="translatedTextContainer" style="display: none;">
                    <span id="translateTextHeading" style="display: none;">Translated to hindi</span>

                    <p id="translatedContent">
                      
                    </p>
                    
                  </div>
                </div>

                <form class="translate-form" id="translateForm">
                  {% csrf_token %}
                  <textarea type="text" name="post_content">{{post.content|safe}}</textarea>
                  <input type="hidden" name="translate_content" value="1">
                </form>

              </div>
                
                <!-- Summarized text will be displayed here -->
                <div class="recipe-body-content summarized-container" id="summarizedContentContainer" style="display: none;">
                  <span id="sumheading" style="display: none;"><h4>Summarized recipe</h4></span>

                  <p id="summarizedtext"></p>
                </div>

              </div>
              

              <!-- Comments -->
              <div class="accordion accordion-flush comments-accordian" id="accordionFlushExample">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasBottom" aria-controls="offcanvasBottom">
                      Comments &nbsp; <span class="tot_recipe_badge badge">{{comments_count}}</span>
                    </button>
                  </h2>
                </div>
              </div>

            
              <div class="postdetail-recipe-container">

                {% if author_recipes.count != 0 %} 
                  <div class="scroll-btn-container recipe-container-scroll-btns d-flex justify-content-between">
                    <div class="recipe-container-caroussel-heading">
                      <small><i>more from</i></small> &nbsp; <small><h3><i>{{post.author.get_full_name}}</i></h3></small>
                    </div>

                    <div class="">
                      <button id="scroll-left" class="scroll-btn">
                        <span class="material-symbols-rounded scroll-icon" onmouseover="ifdisabled(this)" onmouseout="normal(this)" id="scroll-icon-left">arrow_back_ios_new</span>
                      </button>
                    
                    
                      <button id="scroll-right" class="scroll-btn">
                          <span class="material-symbols-rounded scroll-icon">arrow_forward_ios</span>
                      </button>
                    </div>
                  </div> 

                {% else %}  

                {% endif %}               

                <div class="more-recipes-container">
                  <div class="recipes-container-carousel">
                    {% for i in author_recipes %}
                      {% if forloop.first %}
                        <figure class="author-recipe-cards author-first-img">
                            {% for i in i.photo_set.all %}
                                {% if forloop.counter0 == 0 %}
                                    <img src="{{ i.image.url }}" alt="recipe-image">
                                {% endif %}
                            {% endfor %}
                            <p>{{ i.title }} </p>
                            <a href="{% url 'viewpost' i.pk %}" class="stretched-link"></a>
                        </figure>
                        {% else %}
                          {% if post.pk != i.pk %}
                            <figure class="author-recipe-cards">
                              {% for i in i.photo_set.all %}
                                  {% if forloop.counter0 == 0 %}
                                      <img src="{{ i.image.url }}" alt="recipe-image">
                                  {% endif %}
                              {% endfor %}
                              <p>{{ i.title }}</p>
                              <a href="{% url 'viewpost' i.pk %}" class="stretched-link"></a>
                            </figure>
                          {% endif %}
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
                
              </div>

            </div>             
            
        </main>
        
        
        <aside class="sidebar similar-recipes-sidebar">
          
          <div class="sidebar-recipes">
              <div class="sidebar-header">
              
                {% if recommended_recipes %}
                
                <h1>Related recipes</h1>
                
                {% elif post.type == 'Breakfast' %}

                <h1>More breakfast recipes</h1>

                {% elif post.type == 'Lunch' %}

                <h1>More lunch recipes</h1>

                {% elif post.type == 'Evening Snack' %}

                <h1>More snacks recipes</h1>

                {% elif post.type == 'Dinner' %}

                <h1>More dinner recipes</h1>

                {% else %}

                {% endif %}
              </div>

              <div class="dynamic-card-container side-recipes-card-container">
                
                {% if recommended_recipes %}
                  {% for post in recommended_recipes %}
                    <div class="sidebar-cards">    
                      <a href="{% url 'viewpost' post.pk %}">
                        <div class="sidebar-img-container">
                          {% for i in post.photo_set.all %}
                          {% if forloop.counter0 == 0 %}
                              <img src="{{ i.image.url }}" class="widget-image" alt="{{post.title}}">
                          {% endif %}
                            {% empty %}
                              <img src="{% static 'testingapp/media/empty4.jpg' %}" class="widget-image">
                          {% endfor %}
                        </div>

                        <div class="card-body sidebar-recipe-info">
                            <h4 class="card-title highlight">{{post.title}}</h4>
                        </div>
                      </a>
                      <div class="sidebar-cards-qv" title="Quick view">
                          <button class="btn btn-transparent quick-view-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#quickviewModal{{post.pk}}" aria-controls="quickviewModal">
                              <span class="material-symbols-rounded sidebar-recipe-read-more-icon">dock_to_left</span>
                          </button>
                      </div>
                    </div>
                  {% endfor %}

                {% elif post.type == 'Breakfast' %}
                  {% for brkfst in breakfast.all %}

                    {% if post.title != brkfst.title %}

                      <div class="sidebar-cards">    
                          <a href="{% url 'viewpost' brkfst.pk %}">
                            <div class="sidebar-img-container">
                              {% for i in brkfst.photo_set.all %}
                              {% if forloop.counter0 == 0 %}
                                  <img src="{{ i.image.url }}" class="widget-image" alt="{{post.title}}">
                              {% endif %}
                                {% empty %}
                                  <img src="{% static 'testingapp/media/empty4.jpg' %}" class="widget-image">
                              {% endfor %}
                            </div>

                            <div class="card-body sidebar-recipe-info">
                                <h4 class="card-title highlight">{{brkfst.title}}</h4>
                            </div>
                          </a>
                          <div class="sidebar-cards-qv" title="Quick view">
                              <button class="btn btn-transparent quick-view-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#quickviewModal{{brkfst.pk}}" aria-controls="quickviewModal">
                                  <span class="material-symbols-rounded sidebar-recipe-read-more-icon">dock_to_left</span>
                              </button>
                          </div>
                      </div>
                    
                    {% else %}

                    {% endif %}

                  {% endfor %}

                  {% elif post.type == 'Lunch' %} 
                    {% for lnch in lunch.all %} 

                    {% if post.title != lnch.title %}

                      <div class="sidebar-cards">    
                        <a href="{% url 'viewpost' lnch.pk %}">
                          <div class="sidebar-img-container">
                            {% for i in lnch.photo_set.all %}
                            {% if forloop.counter0 == 0 %}
                                <img src="{{ i.image.url }}" class="widget-image" alt="{{post.title}}">
                            {% endif %}
                              {% empty %}
                                <img src="{% static 'testingapp/media/empty4.jpg' %}" class="widget-image">
                            {% endfor %}
                          </div>

                          <div class="card-body sidebar-recipe-info">
                              <h4 class="card-title highlight">{{lnch.title}}</h4>
                          </div>
                        </a>
                        <div class="sidebar-cards-qv" title="Quick view">
                            <button class="btn btn-transparent quick-view-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#quickviewModal{{lnch.pk}}" aria-controls="quickviewModal">
                                <span class="material-symbols-rounded sidebar-recipe-read-more-icon">dock_to_left</span>
                            </button>
                        </div>
                      </div>

                      {% else %}

                      {% endif %}
                  
                    {% endfor %}

                  {% elif post.type == 'Evening Snack' %} 
                      {% for evesnack in evesnack.all %}

                      {% if post.title != evesnack.title %}
                          
                        <div class="sidebar-cards">    
                          <a href="{% url 'viewpost' evesnack.pk %}">
                            <div class="sidebar-img-container">
                              {% for i in evesnack.photo_set.all %}
                              {% if forloop.counter0 == 0 %}
                                  <img src="{{ i.image.url }}" class="widget-image" alt="{{post.title}}">
                              {% endif %}
                                {% empty %}
                                  <img src="{% static 'testingapp/media/empty4.jpg' %}" class="widget-image">
                              {% endfor %}
                            </div>

                            <div class="card-body sidebar-recipe-info">
                                <h4 class="card-title highlight">{{evesnack.title}}</h4>
                            </div>
                          </a>
                          <div class="sidebar-cards-qv" title="Quick view">
                              <button class="btn btn-transparent quick-view-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#quickviewModal{{evesnack.pk}}" aria-controls="quickviewModal">
                                  <span class="material-symbols-rounded sidebar-recipe-read-more-icon">dock_to_left</span>
                              </button>
                          </div>
                        </div>

                      {% else %}

                      {% endif %}
                  
                    {% endfor %}
                    
                  {% elif post.type == 'Dinner' %}
                    
                    {% for dnr in dinner.all %}

                      {% if post.title != dnr.title %}

                        <div class="sidebar-cards">    
                            <a href="{% url 'viewpost' dnr.pk %}">
                              <div class="sidebar-img-container">
                                {% for i in dnr.photo_set.all %}
                                {% if forloop.counter0 == 0 %}
                                    <img src="{{ i.image.url }}" class="widget-image" alt="{{post.title}}">
                                {% endif %}
                                  {% empty %}
                                    <img src="{% static 'testingapp/media/empty4.jpg' %}" class="widget-image">
                                {% endfor %}
                              </div>

                              <div class="card-body sidebar-recipe-info">
                                  <h4 class="card-title highlight">{{dnr.title}}  </h4>
                              </div>
                            </a>
                            <div class="sidebar-cards-qv" title="Quick view">
                                <button class="btn btn-transparent quick-view-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#quickviewModal{{dnr.pk}}" aria-controls="quickviewModal">
                                    <span class="material-symbols-rounded sidebar-recipe-read-more-icon">dock_to_left</span>
                                </button>
                            </div>
                        </div>
                  
                      {% else %}

                      {% endif %}
                      
                    {% endfor %}

                  {% else %}
                      
                  {% endif %}
              </div>

          </div>
          
        </aside>
        
          
      </div>

    </div>
    

    <div class="footer-wrapper">
      {% include 'testingapp/footer.html' %}
    </div>
    
    
    <nav id="navbar-example2" class="bottom-navigation">
      <button type="button" class="bottom-nav-btn" data-bs-toggle="dropdown" aria-expanded="false">
        <span class="material-symbols-rounded recipe-action-icons">list</span>On this page
      </button> 

      <div class="dropdown-menu body-detail-dropdown-content bottom-navigation-dropdown-content">
        <div class="body-detail-dropdown-list">
          <div class="dropdown-second-child">
            <a class="dropdown-links bottom-navlinks" href="#ingredients">Ingredients</a>
      
            <a class="dropdown-links bottom-navlinks" href="#instructions">Instructions</a>
            
            <a class="dropdown-links" href="#summarizedtext">
              <form id="summarizeForm">
                {% csrf_token %}
                <input type="hidden" name="content" value="{{ post.content }}">
                <button type="button" class="summarizeForm" id="toggleSummarizedContent">
                  <span id="buttontext">Summarize recipe</span>
                </button>
              </form>
            </a>
          </div>
        </div>
      </div>
    </nav>

  </div>

  

  {% else %}

  <div class="primary-wrapper">
    
    <div class="secondary-wrapper">

      <div class="container container-flex">

        <main role="main" class="home-main recipe-detail-main">

            <div class="dynamic-recipes recipe-detail-wrapper">                    

              <div class="dynamic-card-container carousel-container recdet-card-container">
                
                <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
                  
                  {% if post.photo_set.all.count == 1 %}
                  {% else %}
                    <div class="carousel-indicators">
                      {% for image in post.photo_set.all %}
                      <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="{{ forloop.counter0 }}" {% if forloop.first %}class="active"{% endif %}></button>
                      {% endfor %}
                    </div>
                  {% endif %}

                  <div class="carousel-inner">
                    {% for post in post.photo_set.all %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                      <img src="{{ post.image.url }}" class="d-block carousel-image" alt="{{ post.title }}">
                    </div>
                    {% empty %}
                    <div>
                      <img src="{% static 'testingapp/media/empty4.jpg' %}" class="d-block carousel-image" alt="{{ post.title }}">
                    </div>
                    {% endfor %}
                  </div>

                  {% if post.photo_set.all.count == 1 %}
                  {% else %}
                    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                      <span class="carousel-control-next-icon" aria-hidden="true"></span>
                      <span class="visually-hidden">Next</span>
                    </button>
                  {% endif %}
                </div>

              </div>


              <div class="recipe-body">
                <h1>{{post.title}}</h1>
                
                <div class="d-flex recipe-details-1">
                  <div class="p-2 auth-img">
                    {% for i in user_profiles %}
                      {% if i.user.email == post.author.email %}
                      <div>
                        <a href="{% url 'userchannelpage' first=post.author.first_name last=post.author.last_name pk=post.author.pk %}">
                          <img src="{{ post.author.profile.profile_img.url }}" alt="Image">
                        </a>
                      </div>
                      {% endif %}
                    {% endfor %}
  
                    <div class="child">
  
                      <div class="card hover-profile-card">
                        <div class="row g-0">
                          <div class="col-lg-4 card-img-container">
                            <img src="{{ post.author.profile.profile_img.url }}" alt="...">
                          </div>
                          <div class="col-md-8">
                            <div class="card-body">
                              <h5 class="card-title">{{ post.author.first_name }} {{ post.author.last_name }}</h5>
                            </div>
                            <div class="cards-footer">
                              {% if total_recipes_by_author == 1 %}
                                {{ total_recipes_by_author }} Recipe
                              {% else %}
                                {{ total_recipes_by_author }} Recipes
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
  
                    </div>
                  </div>
  
                  <div class="p-2 flex-grow-1 auth-name">
                    {% for i in user_profiles %}
                      {% if i.user.email == post.author.email %}
                        <div class="text-truncate">
                          <a href="{% url 'userchannelpage' first=post.author.first_name last=post.author.last_name pk=post.author.pk %}">
                            <b>{{i.user.first_name}} {{i.user.last_name}}</b>
                          </a>
                        </div>
                      {% endif %}
                    {% endfor %}
                    
                    <div class="child">
  
                      <div class="card hover-profile-card">
                        <div class="row g-0">
                          <div class="col-lg-4 card-img-container">
                            <img src="{{ post.author.profile.profile_img.url }}" alt="...">
                          </div>
                          <div class="col-md-8">
                            <div class="card-body">
                              <h5 class="card-title">{{ post.author.first_name }} {{ post.author.last_name }}</h5>
                            </div>
                            <div class="cards-footer">
                              {% if total_recipes_by_author == 1 %}
                                {{ total_recipes_by_author }} Recipe
                              {% else %}
                                {{ total_recipes_by_author }} Recipes
                              {% endif %}
                            </div>
                          </div>
                        </div>
                      </div>
  
                    </div>
                  </div>
  
                  <div class="p-2 like-dislike-div">
                    <div class="like-div">
                      <form>
                    
                        <button class="like-button {% if request.user.profile in post.likes.all %}liked{% endif %}"
                          data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-original-title="Login to like" disabled>
                          {% if request.user.profile in post.likes.all %}  
                            <span class="material-symbols-rounded like-dislike-icon liked">thumb_up</span>  
                          {% else %}
                            <span class="material-symbols-rounded like-dislike-icon">thumb_up</span>  
                          {% endif %}
                        </button>
                        
                        <div class="total-likes" data-post-id="{{ post.id }}">{{ post.total_likes }}</div>
                      </form>
                    </div>
                  </div>
  
                  <div class="p-2 like-dislike-div">
                    <div class="dislike-div">
                      <form>
                    
                        <button class="dislike-button {% if request.user.profile in post.dislikes.all %}disliked{% endif %}"
                          data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-original-title="Login to dislike" disabled>
                          {% if request.user.profile in post.dislikes.all %}  
                            <span class="material-symbols-rounded like-dislike-icon disliked">thumb_down</span>  
                          {% else %}
                            <span class="material-symbols-rounded like-dislike-icon">thumb_down</span>  
                          {% endif %}
                        </button>
                        
                        <div class="total-dislikes" data-post-id="{{ post.id }}">{{ post.total_dislikes }}</div>
                      </form>
                    </div>
                  </div>
  
                  
  
                </div>                

                <!-- views, trending text & read time -->
                <div class="recipe-trending-text">

                  <div class="d-flex justify-content-start">

                    <span class="trending-number">
                      <p>{% get_hit_count for post %} views</p>
                    </span>

                    {% if post.title in top_10_trend_recipes|join:"" %}
                          
                      <span class="trending-number mx-2">
                        <p>#{{check|join:""}} on Trending</p>
                      </span>  

                    {% else %}

                    {% endif %}
                  </div>
                  <span class="trending-number postdetail-readtime"><p>{{ post.read_time }} min read</p></span>
                </div>

                <div class="recipe-detail-container recipe-detail-container-secondary">
                  <div class="left">

                    <div class="recipe-detail-table">
                      <table class="table">
                        <tbody>
                          <tr>
                              <th scope="row" colspan="2">Type</th>
                              <td>:</td>
                              <td>{{post.type}}</td>
                          </tr>
                          <tr>
                              <th scope="row" colspan="2">Category</th>
                              <td>:</td>
                              <td>{{post.category}}</td>
                          </tr>
                          <tr>
                              <th scope="row" colspan="2">Cuisine</th>
                              <td>:</td>
                              <td>{{post.cuisine|cut:" cuisine"}}</td>
                          </tr>
                          <tr>
                              <th scope="row" colspan="2">Prep time</th>
                              <td>:</td>
                              <td>{{post.timing}} min</td>
                          </tr>
                          <tr>
                              <th scope="row" colspan="2">Servings</th>
                              <td>:</td>
                              <td>{{post.servings}}</td>
                          </tr>
                          <tr>
                            <th scope="row" colspan="2">Difficulty</th>
                            <td>:</td>
                            <td>{{post.difficulty}}</td>
                          </tr>
                          <tr>
                              <th scope="row" colspan="2">Posted</th>
                              <td>:</td>
                              <td>{{post.get_date}}</td>
                          </tr>
                          <tr>
                            <th scope="row" colspan="2">Updated</th>
                            <td>:</td>
                            <td>
                              {% if post.get_date == post.get_modified_date %}
                                No change
                              {% else %}
                              {{post.get_modified_date}}
                              {% endif %}
                            </td>
                          </tr>
                            <!-- <tr>
                                <th scope="row" colspan="2">Likes</th>
                                <td>:</td>
                                <td>{{post.total_likes}}</td>
                            </tr>
                            <tr>
                                <th scope="row" colspan="2">Dislikes</th>
                                <td>:</td>
                                <td>{{post.total_dislikes}}</td>
                            </tr> -->
                        </tbody>
                      </table>
                    </div>

                  </div>

                  {% if nutrition_widget|safe %}
                    <div class="right">
                      
                      <div class="recipe-detail-table">
                        {{ nutrition_widget|safe }}

                        <script>
                          document.addEventListener('DOMContentLoaded', function() {
                              var heading1 = document.querySelector('.spoonacular-caption.spoonacular-salmon');
                              var headingBlue = document.querySelector('.spoonacular-caption.spoonacular-blue');
                              var quickviewText = document.querySelector('.spoonacular-caption');
                              
                              if (heading1 && headingBlue) {
                                heading1.textContent = '';
                                headingBlue.textContent = 'More details';
                              }
        
                              if (quickviewText) {
                                quickviewText.style.display = 'none';
                              }
                          });
                        </script>
                      </div>

                    </div>

                  {% endif %}

                </div>

                <div data-spy="scroll" data-target="#navbar-example2" data-offset="50">

                <div class="recipe-body-content ingred-body" id="ingredients">
                  <h4>Ingredients</h4>
                  
                  <div class="recipe-data recipe-data-ingred">
                    {{post.ingredients|safe}}
                  </div>
                </div>

                <div class="recipe-body-content summarizecontent" id="instructions">
                  <h4>Instructions</h4>

                  <div class="recipe-data">
                    {{post.content|safe}}
                  </div>

                  <!-- <p>
                    <pre>{{post.content|safe}}</pre>
                  </p> -->
                  
                </div>

              </div>

              </div>
              

              <!-- Comments -->
              <div class="accordion accordion-flush comments-accordian" id="accordionFlushExample">
                <div class="accordion-item">
                  <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasBottom" aria-controls="offcanvasBottom">
                      Comments &nbsp; <span class="tot_recipe_badge badge">{{comments_count}}</span>
                    </button>
                  </h2>
                </div>
              </div>

              <div class="postdetail-recipe-container">

                {% if author_recipes.count != 0 %} 
                  <div class="scroll-btn-container recipe-container-scroll-btns d-flex justify-content-between">
                    <div class="recipe-container-caroussel-heading">
                      <small><i>more from</i></small> &nbsp; <small><h3><i>{{post.author.get_full_name}}</i></h3></small>
                    </div>

                    <div class="">
                      <button id="scroll-left" class="scroll-btn">
                        <span class="material-symbols-rounded scroll-icon" onmouseover="ifdisabled(this)" onmouseout="normal(this)" id="scroll-icon-left">arrow_back_ios_new</span>
                      </button>
                    
                    
                      <button id="scroll-right" class="scroll-btn">
                          <span class="material-symbols-rounded scroll-icon">arrow_forward_ios</span>
                      </button>
                    </div>
                  </div> 

                {% else %}  

                {% endif %}               

                <div class="more-recipes-container">
                  <div class="recipes-container-carousel">
                    {% for i in author_recipes %}
                      {% if forloop.first %}
                        <figure class="author-recipe-cards author-first-img">
                            {% for i in i.photo_set.all %}
                                {% if forloop.counter0 == 0 %}
                                    <img src="{{ i.image.url }}" alt="recipe-image">
                                {% endif %}
                            {% endfor %}
                            <p>{{ i.title }} </p>
                            <a href="{% url 'viewpost' i.pk %}" class="stretched-link"></a>
                        </figure>
                        {% else %}
                          {% if post.pk != i.pk %}
                            <figure class="author-recipe-cards">
                              {% for i in i.photo_set.all %}
                                  {% if forloop.counter0 == 0 %}
                                      <img src="{{ i.image.url }}" alt="recipe-image">
                                  {% endif %}
                              {% endfor %}
                              <p>{{ i.title }}</p>
                              <a href="{% url 'viewpost' i.pk %}" class="stretched-link"></a>
                            </figure>
                          {% endif %}
                      {% endif %}
                    {% endfor %}
                  </div>
                </div>
                
              </div>

            </div>           
            
        </main>
        
        
        <aside class="sidebar similar-recipes-sidebar">
          
          <div class="sidebar-recipes">
              <div class="sidebar-header">
                {% if recommended_recipes %}
                
                <h1>Related recipes</h1>

                {% elif post.type == 'Breakfast' %}

                <h1>More breakfast recipes</h1>

                {% elif post.type == 'Lunch' %}

                <h1>More lunch recipes</h1>

                {% elif post.type == 'Evening Snack' %}

                <h1>More snacks recipes</h1>

                {% elif post.type == 'Dinner' %}

                <h1>More dinner recipes</h1>

                {% else %}
                

                {% endif %}
              </div>

              <div class="dynamic-card-container side-recipes-card-container">

                {% if recommended_recipes %}
                  {% for post in recommended_recipes %}
                    <div class="sidebar-cards">    
                      <a href="{% url 'viewpost' post.pk %}">
                        <div class="sidebar-img-container">
                          {% for i in post.photo_set.all %}
                          {% if forloop.counter0 == 0 %}
                              <img src="{{ i.image.url }}" class="widget-image" alt="{{post.title}}">
                          {% endif %}
                            {% empty %}
                              <img src="{% static 'testingapp/media/empty4.jpg' %}" class="widget-image">
                          {% endfor %}
                        </div>

                        <div class="card-body sidebar-recipe-info">
                            <h4 class="card-title highlight">{{post.title}}</h4>
                        </div>
                      </a>
                      <div class="sidebar-cards-qv" title="Quick view">
                          <button class="btn btn-transparent quick-view-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#quickviewModal{{post.pk}}" aria-controls="quickviewModal">
                              <span class="material-symbols-rounded sidebar-recipe-read-more-icon">dock_to_left</span>
                          </button>
                      </div>
                    </div>
                  {% endfor %}
                  
                {% elif post.type == 'Breakfast' %}
                  {% for brkfst in breakfast.all %}

                    {% if post.title != brkfst.title %}

                      <div class="sidebar-cards">    
                          <a href="{% url 'viewpost' brkfst.pk %}">
                            <div class="sidebar-img-container">
                              {% for i in brkfst.photo_set.all %}
                              {% if forloop.counter0 == 0 %}
                                  <img src="{{ i.image.url }}" class="widget-image" alt="{{post.title}}">
                              {% endif %}
                                {% empty %}
                                  <img src="{% static 'testingapp/media/empty4.jpg' %}" class="widget-image">
                              {% endfor %}
                            </div>

                            <div class="card-body sidebar-recipe-info">
                                <h4 class="card-title highlight">{{brkfst.title}}</h4>
                            </div>
                          </a>
                          <div class="sidebar-cards-qv" title="Quick view">
                              <button class="btn btn-transparent quick-view-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#quickviewModal{{brkfst.pk}}" aria-controls="quickviewModal">
                                  <span class="material-symbols-rounded sidebar-recipe-read-more-icon">dock_to_left</span>
                              </button>
                          </div>
                      </div>
                    
                    {% else %}

                    {% endif %}

                  {% endfor %}

                  {% elif post.type == 'Lunch' %} 
                    {% for lnch in lunch.all %} 

                    {% if post.title != lnch.title %}

                      <div class="sidebar-cards">    
                        <a href="{% url 'viewpost' lnch.pk %}">
                          <div class="sidebar-img-container">
                            {% for i in lnch.photo_set.all %}
                            {% if forloop.counter0 == 0 %}
                                <img src="{{ i.image.url }}" class="widget-image" alt="{{post.title}}">
                            {% endif %}
                              {% empty %}
                                <img src="{% static 'testingapp/media/empty4.jpg' %}" class="widget-image">
                            {% endfor %}
                          </div>

                          <div class="card-body sidebar-recipe-info">
                              <h4 class="card-title highlight">{{lnch.title}}</h4>
                          </div>
                        </a>
                        <div class="sidebar-cards-qv" title="Quick view">
                            <button class="btn btn-transparent quick-view-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#quickviewModal{{lnch.pk}}" aria-controls="quickviewModal">
                                <span class="material-symbols-rounded sidebar-recipe-read-more-icon">dock_to_left</span>
                            </button>
                        </div>
                      </div>

                      {% else %}

                      {% endif %}
                  
                    {% endfor %}

                  {% elif post.type == 'Evening Snack' %} 
                      {% for evesnack in evesnack.all %}

                      {% if post.title != evesnack.title %}
                          
                        <div class="sidebar-cards">    
                          <a href="{% url 'viewpost' evesnack.pk %}">
                            <div class="sidebar-img-container">
                              {% for i in evesnack.photo_set.all %}
                              {% if forloop.counter0 == 0 %}
                                  <img src="{{ i.image.url }}" class="widget-image" alt="{{post.title}}">
                              {% endif %}
                                {% empty %}
                                  <img src="{% static 'testingapp/media/empty4.jpg' %}" class="widget-image">
                              {% endfor %}
                            </div>

                            <div class="card-body sidebar-recipe-info">
                                <h4 class="card-title highlight">{{evesnack.title}}</h4>
                            </div>
                          </a>
                          <div class="sidebar-cards-qv" title="Quick view">
                              <button class="btn btn-transparent quick-view-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#quickviewModal{{evesnack.pk}}" aria-controls="quickviewModal">
                                  <span class="material-symbols-rounded sidebar-recipe-read-more-icon">dock_to_left</span>
                              </button>
                          </div>
                        </div>

                      {% else %}

                      {% endif %}
                  
                    {% endfor %}
                    
                  {% elif post.type == 'Dinner' %}
                    
                    {% for dnr in dinner.all %}

                      {% if post.title != dnr.title %}

                        <div class="sidebar-cards">    
                            <a href="{% url 'viewpost' dnr.pk %}">
                              <div class="sidebar-img-container">
                                {% for i in dnr.photo_set.all %}
                                {% if forloop.counter0 == 0 %}
                                    <img src="{{ i.image.url }}" class="widget-image" alt="{{post.title}}">
                                {% endif %}
                                  {% empty %}
                                    <img src="{% static 'testingapp/media/empty4.jpg' %}" class="widget-image">
                                {% endfor %}
                              </div>

                              <div class="card-body sidebar-recipe-info">
                                  <h4 class="card-title highlight">{{dnr.title}}  </h4>
                              </div>
                            </a>
                            <div class="sidebar-cards-qv" title="Quick view">
                                <button class="btn btn-transparent quick-view-btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#quickviewModal{{dnr.pk}}" aria-controls="quickviewModal">
                                    <span class="material-symbols-rounded sidebar-recipe-read-more-icon">dock_to_left</span>
                                </button>
                            </div>
                        </div>
                  
                      {% else %}

                      {% endif %}
                      
                    {% endfor %}

                  {% else %}
                      
                  {% endif %}
              </div>

          </div>
          
        </aside>
        
          
      </div>

    </div>
    

    <div class="footer-wrapper">
      {% include 'testingapp/footer.html' %}
    </div>
    
    <nav id="navbar-example2nologin" class="bottom-navigation ithoutlogin">
      <div class="nav nav-pill flex-sm-row">
        <a class="flex-sm-fil nav-link bottom-navlinks active" href="#ingredients">Ingredients</a>
        
        <a class="flex-sm-fil nav-link bottom-navlinks" href="#instructions">Instructions</a>
      </div>
    </nav>

  </div>


    <!-- <script>
      location.href = "{% url 'topostlogin' post.pk %}";
    </script> -->

  {% endif %}
        

</body>

<!-- parallax effect to carousel images -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const primaryWrapper = document.querySelector('.primary-wrapper');
    const carouselImages = document.querySelectorAll('.carousel-image');
    
    primaryWrapper.addEventListener('scroll', function() {
      const scrollPosition = primaryWrapper.scrollTop;
      
      carouselImages.forEach(function(image) {
        image.style.transform = `translateY(${scrollPosition * 0.2}px)`;
      });
    });
  });
</script>

<!-- following toast message -->

{% if messages %}
  {% for message in messages %}
    {% if 'follow_message' in message.tags %}   
      <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
        <div id="followToast" class="toast follow-toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex"> 
                <div class="toast-body">
                    You started following <span>{{post.author.get_full_name}}</span>
                </div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
      </div>

      <script>
        $(document).ready(function() {
          $('#navbar-brand-name').text('Yummy Recipes');
        });
        var successToast = new bootstrap.Toast(document.getElementById('followToast'));
        successToast.show();
      </script>
        
    {% endif %}
  {% endfor %}
{% endif %}


<!-- if authenticated user tries to following itself -->

{% if messages %}
  {% for message in messages %}
    {% if 'same_user' in message.tags %}   
      <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
        <div id="sameUserToast" class="toast follow-toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex"> 
                <div class="toast-body">
                    {{message}}
                </div>
                <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
      </div>

      <script>
        $(document).ready(function() {
          $('#navbar-brand-name').text('Yummy Recipes');
        });
        var successToast = new bootstrap.Toast(document.getElementById('sameUserToast'));
        successToast.show();
      </script>
        
    {% endif %}
  {% endfor %}
{% endif %}


{% if user.is_authenticated %}

  <div class="offcanvas offcanvas-bottom comments-offcanvas" tabindex="-1" id="offcanvasBottom" aria-labelledby="offcanvasBottomLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasBottomLabel">Comments</h5>
      <button class="cmt-offcanvas-btn">
        <span class="material-symbols-rounded btn-close cmt-offcanvas-close" data-bs-dismiss="offcanvas" aria-label="Close">close</span>
      </button>
      
      <div class="hstack gap-3 comment-input" id="cmt">
        <img src="{{ user.profile.profile_img.url }}" class="article-imae">
        <textarea class="form-control me-auto" id="inputComment" type="text" placeholder="Add a comment..." aria-label="Add your comment"></textarea>
        <button type="button" class="btn btn-transparent" value="comment" id="commentbutton"><span class="material-symbols-rounded">send</span></button>
      </div>
    </div>
    <div class="offcanvas-body">

      <div id="comments">
        {% if comments %}

          {% for comment in comments.reverse %}
            <div class="d-flex position-relative comments-section">
              <img src="{{ post.author.profile.profile_img.url }}" class="flex-shrink-0 me-3" alt="..." style="width: 40px;height: 40px;border-radius: 100%;">
              <div class="commented-author">
                <h6>{{ comment.comment_user.first_name }} {{ comment.comment_user.last_name }} &#11825; <span>{{ comment.get_date }}</span> </h6>
                <p>{{ comment.comment }}</p>
              </div>
            </div>
          
          {% endfor %}

        {% else %}

          <p class="no-comment">No comments</p>

        {% endif %}
      </div>

    </div>
  </div>

{% else %}

  <div class="offcanvas offcanvas-bottom comments-offcanvas" tabindex="-1" id="offcanvasBottom" aria-labelledby="offcanvasBottomLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="offcanvasBottomLabel">Comments</h5>
      <button class="cmt-offcanvas-btn">
        <span class="material-symbols-rounded btn-close cmt-offcanvas-close" data-bs-dismiss="offcanvas" aria-label="Close">close</span>
      </button>
    </div>
    <div class="offcanvas-body nologin-offcanvas-body">

      <div id="comments">
        {% if comments %}

          {% for comment in comments.reverse %}
            <div class="d-flex position-relative comments-section">
              <img src="{{ post.author.profile.profile_img.url }}" class="flex-shrink-0 me-3" alt="..." style="width: 40px;height: 40px;border-radius: 100%;">
              <div class="commented-author">
                <h6>{{ comment.comment_user.first_name }} {{ comment.comment_user.last_name }} &#11825; <span>{{ comment.get_date }}</span> </h6>
                <p>{{ comment.comment }}</p>
              </div>
            </div>
          
          {% endfor %}

        {% else %}

          <p class="no-comment">No comments</p>

        {% endif %}
      </div>

    </div>
  </div>

{% endif %}

<!-- recipe images modal -->
<div class="modal fade modal-xl" id="spotlightModal{{post.pk}}" tabindex="-1" aria-labelledby="spotlightModalLabel" aria-hidden="true">
  <div class="modal-dialog spotlight-modal-dialog">
    <div class="modal-content spotlight-modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5" id="spotlightModalLabel">{{post.title}} | {{post.whenpublished}}</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body spotlight-modal-body">

          <div class="cards-wrapper">
              
              <div class="card">
                  {% for i in post.photo_set.all %}
                    
                        <img src="{{ i.image.url }}" class="img-fluid" alt="{{post.title}}">
                    
                  {% endfor %}

                <div class="" style="color: black;">
                  <h3>{{post.title}}</h3>
                <ul>
                  <li>{{post.get_date|date:"F j, Y"}}</li>
                  <li>{{post.date_post.time}}</li>
                </ul>
                </div>
              </div>
          </div>
        
      </div>
      <div class="modal-footer">
          <a href="{% url 'viewpost' post.pk %}" class="btn btn-primary">View recipe</a>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>


<!-- quick view offcanvas -->

{% if all_recipes %} 
{% for post in all_recipes %}
<div class="offcanvas offcanvas-end qv-offcanvas" tabindex="-1" id="quickviewModal{{post.pk}}" aria-labelledby="quickviewModalLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="quickviewModalLabel">Yummy Recipes</h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body qv-modal-body">
      <div class="qv-modal-body-container">
        <article class="article-featured">
            <div class="qv-offcanvas-img-container">
                {% for i in post.photo_set.all %}
                    {% if forloop.counter0 == 0 %}
                        <img src="{{ i.image.url }}" class="article-image qv-offcanvas-img" alt="{{post.title}}">
                    {% endif %}
                    {% empty %}
                        <img src="{% static 'testingapp/media/empty4.jpg' %}" class="modal-rec-img">
                {% endfor %}
            </div>
            
            <div class="qv-offcanvas-title-container">
                <h3 class="article-title">{{post.title}}</h3>
                <p>
                    <ul>
                      <li>
                        <img src="{{ post.author.profile.profile_img.url }}" alt="Image" style="width: 30px; height: 30px; border-radius:100px">
                      </li>
                        <!-- <li><img src="{{ user.profile.profile_img.url }}" style="width: 30px; height: 30px; border-radius:100px" alt="Image"></li> -->
                        <li><div class="text-truncate">{{post.author.first_name}} {{post.author.last_name}}</div>  {{post.get_date}} &#11825; {% get_hit_count for post %} views</li>
                    </ul>
                </p>
            </div>

            <div class="qv-offcanvas-table-wrapper">
                <table class="table">
                    
                    <tbody class="qv-table-body">
                    <tr>
                        <th scope="row" colspan="2">Type</th>
                        <td>{{post.type}}</td>
                    </tr>
                    <tr>
                        <th scope="row" colspan="2">Category</th>
                        <td>{{post.category}}</td>
                    </tr>
                    <tr>
                        <th scope="row" colspan="2">Cuisine</th>
                        <td>{{post.cuisine}}</td>
                    </tr>
                    <tr>
                        <th scope="row" colspan="2">Prep time</th>
                        <td>{{post.timing}} min</td>
                    </tr>
                    <tr>
                        <th scope="row" colspan="2">Servings</th>
                        <td>{{post.servings}}</td>
                    </tr>
                    <tr>
                      <th scope="row" colspan="2">Difficulty</th>
                      <td>{{post.difficulty}}</td>
                    </tr>
                    <tr>
                        <th scope="row" colspan="2">Likes</th>
                        <td>{{post.total_likes}}</td>
                    </tr>
                    <tr>
                        <th scope="row" colspan="2">Dislikes</th>
                        <td>{{post.total_dislikes}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
            
            
        </article>

        <div class="footer-area">
            <a href="{% url 'viewpost' post.pk %}" class="qv-offcanvas-footer-link">View <span class="material-symbols-rounded qv-offcanvas-link-icon">trending_flat</span></a>
        </div>
      </div>
    </div>
</div>
{% endfor %}
{% endif %}

<!-- Simple view modal only for ingredients and instructions -->
<div class="offcanvas offcanvas-end qv-offcanvas simple-offcanvas" tabindex="-1" id="simpleViewModal" aria-labelledby="simpleViewModalLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="quickviewModalLabel">
      <div class="d-flex justify-content-start gap-3">
        <div>
          {% for i in post.photo_set.all %}
          {% if forloop.counter0 == 0 %}
              <img src="{{ i.image.url }}" class="simple-offcanvas-img" alt="{{post.title}}">
          {% endif %}
        {% endfor %}
        </div>
        <div class="d-flex align-self-center">
          <p class="text-truncate">{{post.title}}</p>
        </div>
      </div>
    </h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body simpleview-offcanvas-body">
    <div class="qv-modal-body-container">
      <article class="article-featured">

        <div class="modal-body-content">
          <h4>Ingredients</h4>
          
          <div class="simpleview-recipe-body-content">
            {{post.ingredients|safe}}
          </div>
        </div>

        <div class="modal-body-content">
          <h4>Instructions</h4>
          
          <div class="simpleview-recipe-body-content">
            {{post.content|safe}}
          </div>
        </div>

          
      </article>

      <div class="footer-area" data-bs-dismiss="offcanvas" aria-label="Close">
          <a class="qv-offcanvas-footer-link">Close</a>
      </div>
    </div>
  </div>
</div>

<!-- shopping list modal -->
<div class="modal fade Modal-logout" id="shoppinglistModal" tabindex="-1" aria-labelledby="shoppinglistModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content logoutmodal share-recipe-modal shopping-list-modal">
      <div class="modal-body">
        <div class="modal-body-header">
          <div class="modal-body-scrollable-container">
            <h2 class="modal-body-text-color">Ingredients lists</h2>
            <ul>
              {% for ingredients in list %}
                <li>{{ ingredients.item }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      
        <div class="modal-body-footer">
          <button type="button" class="btn btn-transparent footer-btn cancel-btn" data-bs-dismiss="modal">Close</button>
          <a class="btn btn-transparent modal-logout-btn" href="{% url 'shopping_list' title=post.title pk=post.pk %}">Download list</a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- scrolling bottom cards -->
<script>
  const cardWrapper = document.querySelector('.more-recipes-container');
  const scrollLeftButton = document.getElementById('scroll-left');
  const scrollRightButton = document.getElementById('scroll-right');
  
  function updateScrollButtons() {
      if (cardWrapper.scrollLeft === 0) {
          scrollLeftButton.classList.add('disabled');
      } else {
          scrollLeftButton.classList.remove('disabled');
      }
  
      if (cardWrapper.scrollLeft + cardWrapper.offsetWidth >= cardWrapper.scrollWidth) {
          scrollRightButton.classList.add('disabled');
      } else {
          scrollRightButton.classList.remove('disabled');
      }
  }
  
  updateScrollButtons();
  
  cardWrapper.addEventListener('scroll', updateScrollButtons);
  
  scrollLeftButton.addEventListener('click', () => {
      cardWrapper.scrollLeft -= 320;
      updateScrollButtons();
  });
  
  scrollRightButton.addEventListener('click', () => {
      cardWrapper.scrollLeft += 320;
      updateScrollButtons();
  });
</script>

<!-- showing & hiding the bottom navigation pill on scroll and 
    Changing the navbar brand name to recipe title on scroll only when url is viewpost -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    var bottomNavigation = document.getElementById('navbar-example2');
    var instructionsHeading = document.getElementById('instructions-heading');
    var hasScrolledPast = false;

    var observerOptions = {
      root: null,
      rootMargin: '-200px',
      threshold: 0
    };

    var bottom_nav_observer = new IntersectionObserver(function (entries, observer) {
      entries.forEach(function (entry) {
        if (entry.isIntersecting) {
          // bottomNavigation.classList.add('show-nav');
          bottomNavigation.style.bottom = '0';
          hasScrolledPast = false;
        } 
        else {
          if (!hasScrolledPast) {
            hasScrolledPast = true;
          } 
          // else {
          //   bottomNavigation.classList.remove('show-nav');
          // }
        }
      });
    }, observerOptions);

    bottom_nav_observer.observe(instructionsHeading);

  });

  $(document).ready(function() {
    var navbarBrand = $("#navbar-brand-name");
    var primaryWrapper = $(".primary-wrapper");
    var bottomNavigation = document.getElementById('navbar-example2');
    var h1tag = $("h1");  

    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (!entry.isIntersecting) {
          navbarBrand.text("{{post.title}}").attr("href", "{% url 'viewpost' post.id %}");
        } 
        else {
          navbarBrand.text("Yummy Recipes").attr("href", "{% url 'home' %}");
          // bottomNavigation.classList.remove('show-nav');
          bottomNavigation.style.bottom = '-100%';
        }
      });
    });

    observer.observe(h1tag[0]);
  });

</script>
  
<!-- Adding active class to the bottom navigation pill -->
<script>
$(document).ready(function () {
    $('.nav-link').click(function () {
        $('.nav-link').removeClass('active');

        $(this).addClass('active');
    });
});
</script>

<!-- Updating like form using ajax (icon & counter) -->
<script>
  $(document).ready(function() {
    $('.like-button').click(function(e) {
        e.preventDefault();

        var post_id = $(this).data('post-id');
        var csrf_token = $('input[name="csrfmiddlewaretoken"]').val();

        $.ajax({
            type: 'POST',
            url: '{% url "like-view" %}',
            data: {
                'post_id': post_id,
                'csrfmiddlewaretoken': csrf_token,
            },
            success: function(response) {
                $('.total-likes[data-post-id="' + post_id + '"]').text(response.total_likes);

                $('.like-button[data-post-id="' + post_id + '"] .like-dislike-icon').toggleClass('liked');

                var tooltipTitle = (response.action === 'remove') ? 'I like this' : 'Unlike';
                $('.like-button[data-post-id="' + post_id + '"]').attr('data-bs-original-title', tooltipTitle);
                // tooltip('show') 
                $('.like-button[data-post-id="' + post_id + '"]').tooltip('show');
                $('.like-button[data-post-id="' + post_id + '"]').tooltip('hide');

                if (response.removefromdislike){
                  $('.total-dislikes').text(response.total_dislikes);
                  $('.dislike-button .like-dislike-icon').removeClass('disliked');
                }
            },
            error: function(error) {
                console.log(error);
            }
        });
    });
  });
</script>

<!-- Updating dislike form using ajax (icon & counter) -->
<script>
  $(document).ready(function() {
      $('.dislike-button').click(function(e) {
          e.preventDefault();

          var post_id = $(this).data('post-id');
          var csrf_token = $('input[name="csrfmiddlewaretoken"]').val();

          $.ajax({
              type: 'POST',
              url: '{% url "dislike-view" %}',
              data: {
                  'post_id': post_id,
                  'csrfmiddlewaretoken': csrf_token,
              },
              success: function(response) {
                  
                  $('.total-dislikes[data-post-id="' + post_id + '"]').text(response.total_dislikes);

                  
                  $('.dislike-button[data-post-id="' + post_id + '"] .like-dislike-icon').toggleClass('disliked');

                  var tooltipTitle = (response.action === 'added') ? 'Remove from dislike' : 'I dislike this';
                  $('.dislike-button[data-post-id="' + post_id + '"]').attr('data-bs-original-title', tooltipTitle);
                  // tooltip('show') 
                  $('.dislike-button[data-post-id="' + post_id + '"]').tooltip('show');
                  $('.dislike-button[data-post-id="' + post_id + '"]').tooltip('hide');

                  if (response.removefromlike){
                    $('.total-likes').text(response.total_likes);
                    $('.like-button .like-dislike-icon').removeClass('liked');
                  }
              },
              error: function(error) {
                  console.log(error);
              }
          });
      });
  });
</script>

<!-- summarizing content (instruction) using api -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
  const form = document.getElementById('summarizeForm');
  const toggleButton = document.getElementById('toggleSummarizedContent');
  const container = document.getElementById('summarizedContentContainer');
  const responseText = document.getElementById('summarizedtext');
  const sHeading = document.getElementById('sumheading');
  const bodyContent = document.querySelector('.summarizecontent');
  const summarizedContainer = document.querySelector('.summarized-container');

  const btmNavbtn = document.getElementById('buttontext');

  let isSummarized = false;

  toggleButton.addEventListener('click', function () {
    if (!isSummarized) {
      bodyContent.classList.add('analyzing');
      btmNavbtn.innerHTML = 'Summarizing...'

      const formData = new FormData(form);

      $.ajax({
        type: 'POST',
        url: '{% url "summarize_content" %}', 
        data: formData,
        processData: false,
        contentType: false,
        success: function (response) {

          if (response.status_code != 401 && response.status_code != 429 && response.summarizedContent !== 'None'){
            bodyContent.classList.remove('analyzing');
            summarizedContainer.classList.add('containercolor')
            sHeading.style.display = 'block';

            btmNavbtn.innerHTML = 'Summarize recipe';

            // responseText.innerHTML = response.summarizedContent;

            const contentLetters = response.summarizedContent.split('');
            let index = 0;

              const typingInterval = setInterval(function () {
                responseText.innerHTML += contentLetters[index];

                  index++;

                  if (index === contentLetters.length) {
                      clearInterval(typingInterval);
                  }
              }, 50); 
          }
          
          else {
            btmNavbtn.innerHTML = 'Summarize recipe';
            container.style.display = isSummarized ? 'none' : 'block';
            var errorToast = new bootstrap.Toast(document.getElementById('APIerrorToast'));
            errorToast.show();
          }

        },
        error: function (error) {
          console.error('Error:', error);
        },
        complete: function () {
          bodyContent.classList.remove('analyzing');
        }
      });
    }

    container.style.display = isSummarized ? 'none' : 'block';
    isSummarized = !isSummarized;
    });
  });

</script>

<!-- API error toast -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
  <div id="APIerrorToast" class="toast follow-toast" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="d-flex"> 
          <div class="toast-body">
              API error
          </div>
          <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
  </div>
</div>

<!-- recipe content translation to hindi -->
<script>
$(document).ready(function() {
    $("#translateButton").on("click", function(event) {
        event.preventDefault();  // Prevent the default form submission or button behavior

        var postContent = $("textarea[name='post_content']").val();  // Get the textarea content
        var csrfToken = $("input[name='csrfmiddlewaretoken']").val();  // Get CSRF token

        $('.summarizecontent').addClass('analyzing');

        $.ajax({
            type: "POST",
            url: window.location.href,  // Correct URL for the request
            data: {
                csrfmiddlewaretoken: csrfToken,
                translate_content: 1,
                post_content: postContent  // Send content as data, not in the URL
            },
            success: function(data) {
                // Handle success
                if (data.error) {
                    alert(data.error);  // Show error message if there is an error
                    $('.summarizecontent').removeClass('analyzing');
                    return;
                }

                $('#translateTextHeading').show();
                $('#translatedTextContainer').show();
                $('.translatedcontainer').addClass('containercolor');
                $('.summarizecontent').removeClass('analyzing');

                const contentLetters = data.translated_text.split('');
                let index = 0;

                const typingInterval = setInterval(function () {
                    $('#translatedContent').html($('#translatedContent').html() + contentLetters[index]);

                    index++;

                    if (index === contentLetters.length) {
                        clearInterval(typingInterval);
                    }
                }, 50); 
            },
            error: function(error) {
                alert("An error occurred. Please try again later.");
                $('.summarizecontent').removeClass('analyzing');
                console.log(error);
            }
        });
    });
});

</script>

<!-- Show/hide the audio tag -->
<script>
  $(document).ready(function() {
      $("#listenButton").on("click", function() {
        $("#audioPlayer").slideToggle(500, function() {
            if ($("#audioPlayer").is(":visible")) {
                $("#listenButton").addClass("listenButton-button");
            } else {
                $("#listenButton").removeClass("listenButton-button");
            }
        });
      });
  });

  
  const translateform = document.getElementById('translateForm');
  const translateButton = document.getElementById('translateButton');

  translateButton.addEventListener('click', () => {
      translateform.submit();
  });
</script>

<!-- showing comment using ajax -->
<script>
  var options = [];

    $( '#commentbutton' ).on( 'click', function( event ) {
    var comt = $('#inputComment').val();
    console.log(comt);
    
    
    
    $.ajax(
    {
    method: 'POST',
    url:'',
    
    data:{
    comt: comt,
    csrfmiddlewaretoken: '{{ csrf_token }}'
    },
    
    success:function(response)
    {
      var data_comments = $.parseJSON(response.cmt);
      var data_f = data_comments[0].fields;
      
      $('#inputComment').val("");

      var formattedDate = new Intl.DateTimeFormat('en-US', {
                  year: 'numeric',
                  month: 'short',
                  day: 'numeric'
              }).format(new Date(data_f.date_comment));

      $('#comments').prepend('<div class="d-flex position-relative comments-section">'+
      '<img src="{{ post.author.profile.profile_img.url }}" class="flex-shrink-0 me-3" alt="Image" style="width: 40px;height: 40px;border-radius: 100%;">'+
      '<div class="commented-author"><h6>{{ request.user.first_name }} {{ request.user.last_name }} &#11825; ' + formattedDate + ' </h6>'+
      

      '<p>'+  data_f.comment +'</p>'+'</div>');
      '</div>'

                var newCommentsCount = parseInt($('.tot_recipe_badge').text()) + 1;
                $('.tot_recipe_badge').text(newCommentsCount);
      },
      
      failure: function(data)
      {
      alert("error occured ")
      }
      
      });
      });
</script> 

<!-- scroll progress indicator on navbar with bgcolor and rotating logo svg -->
<script>
  let scrollTimeout;
  document.getElementById('scrollableDiv').addEventListener('scroll', function() {
    const logoSvg = document.querySelector('.nvarbar-circle-svg')
    const scrollTop = this.scrollTop;
    const scrollHeight = this.scrollHeight - this.clientHeight;
    const scrollPercentage = (scrollTop / scrollHeight) * 100;

    const scrollIndicator = document.querySelector('.scroll-indicator');
    const scrollPercentValue = document.querySelector('.scroll-value');

    const logo = document.querySelector('.nrweb-logo');

    const navbar = document.querySelector('.navbar');
    const progressNavbarColor = navbar.getAttribute('data-primary-color');
  

    if (scrollPercentage === 0) {
      logoSvg.style.transform = 'rotate(0deg)';
      navbar.style.background = 'transparent';
      scrollIndicator.style.opacity = '0';
      logo.style.opacity = 1;
    } 
    else {
      const rotationDegree = (scrollPercentage / 100) * 360; 
      logoSvg.style.transform = `rotate(${rotationDegree}deg)`;
      navbar.style.background = `linear-gradient(to right, ${progressNavbarColor} ${scrollPercentage}%, transparent ${scrollPercentage}%)`;
      scrollIndicator.style.opacity = '1';
      scrollPercentValue.innerText = `${Math.round(scrollPercentage)}%`;
      logo.style.opacity = 0;
    }

    if (scrollTimeout) {
      clearTimeout(scrollTimeout);
    }

    scrollTimeout = setTimeout(function() {
      scrollIndicator.style.opacity = '0';
      logo.style.opacity = 1;
    }, 1000);

  });
</script>

<!-- share recipe modal -->

<div class="modal fade Modal-logout" id="shareRecipeModal" tabindex="-1" aria-labelledby="shareRecipeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content logoutmodal share-recipe-modal">
      <div class="modal-body">
        <div class="modal-body-header">
          <h2 class="modal-body-text-color">Share</h2>
          
          <div class="nav nav-tabs" id="nav-tab" role="tablist">
            <button class="nav-link active" id="nav-social-media-tab" data-bs-toggle="tab" data-bs-target="#nav-social-media" type="button" role="tab" aria-controls="nav-social-media" aria-selected="true">Links</button>
            <button class="nav-link" id="nav-qr-code-tab" data-bs-toggle="tab" data-bs-target="#nav-qr-code" type="button" role="tab" aria-controls="nav-qr-code" aria-selected="false">QR Code</button>
          </div>
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="nav-social-media" role="tabpanel" aria-labelledby="nav-social-media-tab" tabindex="0">
              <div class="share-links-container">
                <div class="share-sheet-links">
                  <a href="https://www.gmail.com/" class="fa-solid fa-envelope" target="_blank"></a>
                  <p>Gmail</p>
                </div>
                <div class="share-sheet-links">
                  <a href="https://www.facebook.com/" class="fa-brands fa-facebook-f" target="_blank"></a>
                  <p>Facebook</p>
                </div>
                <div class="share-sheet-links">
                  <a href="https://www.instagram.com/" class="fa-brands fa-instagram" target="_blank"></a>
                  <p>Instagram</p>
                </div>
                <div class="share-sheet-links">
                  <a href="https://telegram.org/" class="fa-brands fa-telegram" target="_blank"></a>
                  <p>Telegram</p>
                </div>
                <div class="share-sheet-links" id="shoe-div">
                  <!-- <a href="https://www.whatsapp.com" class="fa-brands fa-whatsapp" target="_blank"></a> -->
                  <a href="" id="whatsapp-share-button" class="fa-brands fa-whatsapp"></a>
                  <p>WhatsApp</p>
                </div>
                <div class="share-sheet-links">
                  <a href="https://x.com/?lang=en" class="fa-brands fa-x-twitter" target="_blank"></a>
                  <p>X</p>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="nav-qr-code" role="tabpanel" aria-labelledby="nav-qr-code-tab" tabindex="0">
              <div class="qr-code-container d-flex justify-content-center">
                <div class="d-flex justify-content-center align-items-center">
                  <img src="data:image/png;base64,{{ img_data }}" alt="QR Code" style="border-radius: 10px;">
                </div>
              </div>
            </div>
          </div>

          <button class="clipboard share-recipe-footerbtn" id="copylink" onclick="Copy();">
            <span class="material-symbols-rounded share-recipe-icon">content_copy</span>
            <span class="button-text">Copy link</span> &nbsp; <span id="linktext"></span>
          </button>
        </div>

        <div class="modal-body-footer">
          <div class="modal-body-footer">
            <button type="button" class="btn btn-transparent footer-btn cancel-btn" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
    
<!-- open whatsapp desktop app if installed to share link -->
<script>
  $(document).ready(function() {
    $("#whatsapp-share-button").click(function(e) {
      e.preventDefault(); 

      var url = window.location.href;
      var WhatsappUrl = "whatsapp://";

      if (WhatsappUrl) {
        var whatsappUrl = "whatsapp://send?text=" + encodeURIComponent(url);
        window.location.href = whatsappUrl;
      }

      else if(WhatsappUrl == ""){
        window.location.href = 'https://www.whatsapp.com';
      }
      
    });
  });
</script>


<!-- link copied toast message -->

<!-- <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
  <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">
      <div class="d-flex"> 
          <div class="toast-body" id="urlCopied">
              
          </div>
          <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
  </div>
</div> -->

<!-- Link copy toast -->
<!-- <script>
  const toastTrigger = document.getElementById('copylink')
  const toastLiveExample = document.getElementById('liveToast')
  if (toastTrigger) {
    toastTrigger.addEventListener('click', () => {
    const toast = new bootstrap.Toast(toastLiveExample)

    toast.show()
  })
}
</script> -->

<!-- share link url when clicked on copy link -->
<script>
  $(document).ready(function(){
    $('#copylink').click(function(){
    
      var url = window.location.href;
      navigator.clipboard.writeText(url);
      var $buttonText = $('#copylink .button-text');
      var $linkicon = $('.share-recipe-icon');
      var $linktext = $('#linktext');


      $buttonText.text('Link Copied :');
      $buttonText.css("font-weight", "bold");
      $linkicon.addClass('link-icon-active');

      setTimeout(function(){
        $buttonText.text('Copy link');
        $buttonText.css("font-weight", "normal");
        $linktext.text('');
        $linkicon.removeClass('link-icon-active');
      }, 3000);  
    });

  });
    
  function Copy() {
    //var Url = document.createElement("textarea");

    // urlCopied.innerHTML = window.location.href;
    linktext.innerHTML = window.location.href;
    
    //Copied = Url.createTextRange();
    //Copied.execCommand("Copy");
  }
</script>
    
{% endblock %}